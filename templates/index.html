{% extends "base.html" %}

{% block title %}Plant Disease Detection - Upload Image{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <!-- Header -->
        <div class="text-center mb-5">
            <h1 class="display-4 text-success">
                <i class="fas fa-leaf"></i> Plant Disease Detector
            </h1>
            <p class="lead">Upload a plant image to get instant disease analysis with treatment recommendations</p>
            <div class="row text-center mt-4">
                <div class="col-md-4">
                    <div class="feature-box">
                        <i class="fas fa-microscope fa-2x text-primary mb-2"></i>
                        <h5>99.66% Accuracy</h5>
                        <p class="text-muted">AI-powered disease detection</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-box">
                        <i class="fas fa-seedling fa-2x text-success mb-2"></i>
                        <h5>Treatment Advice</h5>
                        <p class="text-muted">Fertilizer & manure recommendations</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-box">
                        <i class="fas fa-cloud-sun fa-2x text-warning mb-2"></i>
                        <h5>Weather Analysis</h5>
                        <p class="text-muted">Environmental risk assessment</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upload Form -->
        <div class="card shadow-lg">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">
                    <i class="fas fa-upload"></i> Upload Plant Image
                </h4>
            </div>
            <div class="card-body">
                <form action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data" id="uploadForm">
                    <!-- File Upload -->
                    <div class="mb-4">
                        <label for="file" class="form-label">
                            <strong>Select Plant Image</strong>
                        </label>
                        <input type="file" class="form-control form-control-lg" id="file" name="file" 
                               accept="image/*" required onchange="previewImage(this)">
                        <div class="form-text">
                            <i class="fas fa-info-circle"></i> 
                            Supported formats: JPG, PNG, JPEG, GIF (Max 16MB)
                        </div>
                    </div>

                    <!-- Image Preview -->
                    <div class="mb-4" id="imagePreview" style="display: none;">
                        <label class="form-label"><strong>Preview</strong></label>
                        <div class="text-center">
                            <img id="preview" src="" alt="Preview" class="img-thumbnail" style="max-height: 300px;">
                        </div>
                    </div>

                    <!-- Location Input -->
                    <div class="mb-4">
                        <label for="location" class="form-label">
                            <strong>Location (Optional)</strong>
                        </label>
                        <input type="text" class="form-control" id="location" name="location" 
                               placeholder="e.g., Chicago, New York, Mumbai" 
                               value="">
                        <div class="form-text">
                            <i class="fas fa-map-marker-alt"></i> 
                            Location helps provide weather-based disease risk analysis
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="d-grid">
                        <button type="submit" class="btn btn-success btn-lg" id="submitBtn">
                            <i class="fas fa-microscope"></i> Analyze Plant Disease
                        </button>
                    </div>
                </form>

                <!-- Loading Animation -->
                <div id="loadingDiv" style="display: none;" class="text-center mt-4">
                    <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Analyzing your plant image...</p>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" 
                             role="progressbar" style="width: 100%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sample Images -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-images"></i> Sample Images for Testing
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="text-center">
                            <img src="{{ url_for('static', filename='images/sample_apple_scab.jpg') }}" 
                                 alt="Apple Scab Sample" class="img-thumbnail mb-2" style="height: 150px; object-fit: cover;">
                            <p class="small text-muted">Apple Scab Example</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="text-center">
                            <img src="{{ url_for('static', filename='images/sample_late_blight.jpg') }}" 
                                 alt="Late Blight Sample" class="img-thumbnail mb-2" style="height: 150px; object-fit: cover;">
                            <p class="small text-muted">Late Blight Example</p>
                        </div>
                    </div>
                </div>
                <p class="text-center mt-2">
                    <small class="text-muted">
                        <i class="fas fa-lightbulb"></i> 
                        For best results, use clear, well-lit images showing the affected plant parts
                    </small>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
function previewImage(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('preview').src = e.target.result;
            document.getElementById('imagePreview').style.display = 'block';
        }
        reader.readAsDataURL(input.files[0]);
    }
}

document.getElementById('uploadForm').addEventListener('submit', function() {
    document.getElementById('submitBtn').style.display = 'none';
    document.getElementById('loadingDiv').style.display = 'block';
});
</script>
{% endblock %}
